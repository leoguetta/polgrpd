\section{Basic notions on $\pair{\omega}{k}$-categories}\label{sec:basics}
\subsection{Strict $\pair{\omega}{k}$-categories}\label{subsec:okcat}
\subsubsection{Globular sets}\label{ssubsec:globset}
Consider first the small category $\glob$ of globes, whose objects are
the integers $n\in\N$ and whose morphisms 
are generated by a double family
  \[
  \cosce{n},\cotge{n}: n\to n+1,
\]
where $n\in\N$,
subject to the ``coglobular'' equations
\begin{align*}
  \cosce{n+1}\circ\cosce{n} & = \cotge{n+1}\circ\cosce{n},\\
  \cosce{n+1}\circ\cotge{n} & = \cotge{n+1}\circ\cotge{n}.
\end{align*}
Thus, for any pair $\pair mn$ of integers, the homset $\homset{\glob}{m}{n}$ contains exactly two morphisms if $m<n$, only the identity if $m=n$ and none if $m>n$.

A {\em globular set} $X$ is a presheaf on $\glob$, which amounts to a sequence
$(X_n)_{n\in\N}$ of sets, together with a double sequence of {\em source} and {\em target} maps
\[
  \xymatrix{
    X_0 & X_1 \doubl{\sce{0}}{\tge{0}}& \doubl{\sce{1}}{\tge{1}}\cdots & X_n \doubl{\sce{n-1}}{\tge{n-1}}& \doubl{\sce{n}}{\tge{n}} X_{n+1}& \cdots \doubl{\sce{n+1}}{\tge{n+1}}},
\]
subject to the globular equations
\begin{align*}
  \sce{n}\circ\sce{n+1} & = \sce{n}\circ\tge{n+1},\\
  \tge{n}\circ\sce{n+1}& = \tge{n}\circ\tge{n+1}.
\end{align*}
We denote by $\oGlob$ the category of globular sets and natural transformations. Let $X$ be a globular set and  $m$, $n$ integers such that $0\leq m<n$. The maps
\begin{align*}
  \sce{m}^n & = \sce{m}\circ\cdots\circ \sce{n-1}\\
   \tge{m}^n & = \tge{m}\circ\cdots\circ \tge{n-1}
\end{align*}
are the only two elements of $\homset{\oGlob}{X_n}{X_m}$. We often drop the subscript and write $\sce{m},\tge{m}:X_n\to X_m$ in this case. The elements of $X_n$ are called {\em cells of dimension $n$}  or {\em $n$-cells}. For any $n$-cell $x\in X_n$ and $m<n$, the $m$-cells $\sce m(x)$ and $\tge m(x)$ are respectively the {\em $m$-source} and {\em $m$-target} of $x$. Whenever $\sce m(y)=\tge m(x)$, we say that $x$, $y$ are {\em $m$-composable}.
If $n>0$, $x\in X_n$, $u=\sce{n-1}(x)$ and $v=\tge{n-1}(x)$, we shall write $x:u\to v$.
Finally, two $n$-cells $x,y\in X_n$ are {\em parallel} if either $n=0$ or $n>0$ and $x$, $y$ have the same $(n{-}1)$-source and the same $(n{-}1)$-target.
\begin{paragr}
  Let $n\in \N$. By discarding everything above level $n$ in the previous construction, we get the notions of {\em $n$-globular set} and corresponding category $\nGlob n$. For any $m\in\N\cup\set{\omega}$ such that $n<m$, there is an obvious truncation functor $\nGlob m\to \nGlob n$, right adjoint to the inclusion functor $\nGlob n\to \nGlob m$.
\end{paragr}


\subsubsection{$\omega$-Categories}\label{ssubsec:ocat}

A strict \oo-category  is a globular set $C$ equipped with a family of identity maps
$\unit n:C_{n-1}\to C_n$ for $n>0$ and a family of partial binary composition operations  $\comp i:C_n\times C_n\to C_n$ for $0\leq i< n$, subject to the following list of conditions. 
\begin{enumerate}
\item
  \begin{enumerate}
  \item For each $n>0$ and $x\in C_{n-1}$, $\unit{n}(x): x\to x$.
  \item If $0\leq i<n$ and $x,y\in X_n$ are $i$-composable, then the composite $z=x\comp i y\in C_n$ is defined and
    \begin{itemize}
    \item for $i<n-1$,
      \begin{align*}
        \sce{n-1}(z) & =\sce{n-1}(x)\comp i\sce{n-1}(y)\quad \hbox{and}\\
        \tge{n-1}(z) & =\tge{n-1}(x)\comp i\tge{n-1}(y) ;
      \end{align*}
    \item  for $i=n-1$,
      \begin{align*}
        \sce{n-1}(z) & =\sce{n-1}(x) \quad \hbox{and}\\
         \tge{n-1}(z) & =\tge{n-1}(y).
      \end{align*}
    \end{itemize}
    \end{enumerate}
\item
  \begin{enumerate}
  \item If $0\leq i <n-1$ and $x$, $y$ are $i$-composable $(n{-}1)$-cells, then
    \begin{align*}
      \unit n(x\comp i y) & =\unit n(x)\comp i \unit n(y).
    \end{align*}
  \item If $0\leq i<n$ and $x$ is an $n$-cell, then
    \[\unit n(\sce i(x))\comp i x=x=x\comp i\unit n(\tge i(x))\]
    where, for any $i$-cell $u$, $\unit n(u)$ stands for $\unit n\circ\cdots\circ\unit{i+1}(u)$.
  \item Compositions are {\em associative}, that is, if $0\leq i<n$ and $x$, $y$, $z$ are $n$-cells such that $x$, $y$ and $y$, $z$ are $i$-composable, then
    \[(x\comp i y)\comp i z=x\comp i (y\comp i z).\]
  \item The {\em exchange rule} holds, that is, if $0\leq i<j<n$ and $x$, $y$, $z$, $t$ are $n$-cells such that $x$, $y$ and $z$, $t$ are $j$-composable, whereas $x$, $z$ and $y$, $t$ are $i$-composable, then
    \[(x\comp j y)\comp i (z\comp j t)= (x\comp i z)\comp j (y\comp i t).\]
  \end{enumerate}
\end{enumerate}
Let $C$, $D$ be two \oo-categories. A {\em morphism} $f:C\to D$ is a
morphism of the underlying globular sets preserving identities and
$\comp i$-compositions. Strict \oo-categories and morphisms build a
category denoted by $\oCat$. When necessary, we denote by $\sce
i^C,\tge i^C$ the source and target maps of a given \oo-category $C$.
\begin{remark}
  For any $n>0$ and $n$-cell $x$, the pair $\pair{\sce{n-1}(x)}{\tge{n-1}(x)}$ will be called the {\em type} of $x$. Thus the conditions of the first group above ensure that the units and compostion operations are well-typed. The conditions of the second group are rules of computation and one easily checks that all equations preserve the types. 
\end{remark}
\subsubsection{$n$-Categories}\label{ssubsec:ncat}
For a given $n\in\N$, truncating the previous construction at dimension $n$ yields the notion of $n$-category.  We denote by $\nCat n$ the resulting category. For example $\nCat 0$ is the category $\Set$ of sets and $\nCat 1$ is the category of small categories if we interpret $f\comp 0 g$ as the compostion $g\circ f$ of two morphisms.
For $n\in\N$ and $m\in\N\cup \set{\omega}$ such that $n<m$, there are 
obvious truncation functors $\trk n:\nCat m\to \nCat n$ discarding all cells of dimension $>n$. The functor $\trk n$ is right-adjoint to the inclusion functor  $\inc n:\nCat n\to\nCat m$, which takes an $n$-category $C$ to the $m$-category $C'$ with the same $i$-cells for $i\leq n$ and only the required identity cells in dimensions $n<i\leq m$.

\subsubsection{Invertible cells}\label{ssubsec:invert}
Let $C$ be an \oo-category, $0\leq i <n$. An $n$-cell $x$ of $C$ is {\em $\comp i$-invertible} if there is an $n$-cell $y$ such that $\sce i(y)=\tge i(x)$, $\tge i(y)=\sce i(x)$ satisfying the equations 
  \begin{align*}
    x\comp i y & = \unit n(\sce i(x)) \quad \hbox{and}\\
    y\comp i x & =  \unit n(\tge i(x)).
  \end{align*}
  Such an $n$-cell $y$ is necessarily unique if it exists. A
  $\comp {n-1}$-invertible $n$-cell is simply called {\em invertible}. 
  \begin{proposition}\label{prop:invcell}
    If $0\leq i< j<n$ and $x$ is a $\comp i$-invertible cell, it is also $\comp j$-invertible.
  \end{proposition}
  \begin{paragr}
    \cref{prop:invcell} is proved
    in~\cite[14.5]{abgmmm:polybk}. Beware that the $\comp j$-inverse
    of $x$ is not the same $n$-cell as its $\comp i$-inverse except in
    very degenerate cases. Let $k$ be a fixed integer. An \oo-category
    $C$ is an {\em \ook{k}-category} if for each $n>k$, all $n$-cells
    of $C$ are invertible. It turns out that this implies the stronger
    condition of $\comp i$-invertibility for {\em all} $k<i<n$ (see
    again~\cite[14.5]{abgmmm:polybk}).  The full subcategory of
    $\oCat$ whose objects are \ook{k}-categories is denoted by $\opCat
    k$. Likewise, one defines the truncated version $\npCat nk$ for
    any $0\leq k<n$.  For example $\npCat 10$ is the category $\Grpd$
    of small groupoids and $\opCat 0$ the category $\oGrpd$ of
    \oo-groupoids. The present article pays a special attention to the
    cases $k=0$ and $k=1$. It will be convenient to extend the
    notation for $k\geq n$, in which case $\npCat nk=\nCat n$.
 \end{paragr} 


 \subsection{$\pair{\omega}{k}$-polygraphs}\label{subsec:okpol}
 \subsubsection{Cellular extensions}\label{ssubsec:cellext}
 Let $n>0$ and $C$ an $n$-category. A {\em cellular extension} consists of a pair $\clx{C}{X}$, where $X$ is a  family $X=\pair{x_i}{x'_i}_{i\in I}$ of pairs of parallel $n$-cells in $C$ indexed by a set $I$. Let $\clx CX$, $\clx DY$ be two cellular extensions of the $n$-categories $C$ and $D$ respectively, with $X=\pair{x_i}{x'_i}_{i\in I}$ and $Y=\pair{y_j}{y'_j}_{j\in J}$. A {\em morphism}
 \[\phi:\clx CX\to\clx DY\]
 consists of a pair $\phi=\pair fg$ where $f:C\to D$ is a morphism in $\nCat n$ and $g:I\to J$ is a map such that for each $i\in I$, $y_{g(i)}=f(x_i)$ and $y'_{g(i)}=f(x'_i)$. Cellular extensions and morphisms build a category $\nCatp n$. Now, any $(n{+}1)$-category $C$ determines a cellular extension $\clx{\trk n C}{X}$ of its truncated $n$-category $\trk n C$ by the family
 \[X=\pair{\sce n(x)}{\tge n(x)}_{x\in C_{n+1}}\]
 indexed by all $(n{+}1)$-cells of $C$. This immediately yields a forgetful functor
 \[\fgf n:\nCat {n+1}\to \nCatp n.\]
Now, for any $k\leq n$, this functor $\fgf n$ restricts to
$\npCat{n+1}{k}$. As the image of an $\pair {n{+}1}k$-category is an
$\pair nk$-category, we get a forgetful functor
\[\fgf{n,k}:\npCat{n+1}{k}\to \npCat nk.\]
This functor $\fgf{n,k}$ admits a left-adjoint
\[\frf{n,k}:\npCat nk\to \npCat{n+1}{k}\]
whose precise description plays a central role in the present
work. The existence of this left-adjoint is proved
in~\cite{batanin:comfmg} (see also~\cite[Ch.18]{abgmmm:polybk}). To
avoid tedious distinctions in the following, we recall the convention that
for any $k\geq n$, $\npCat nk=\nCat n$, and in the same way we set
$\fgf{n,k}=\fgf n$ and $\frf{n,k}=\frf n$ in this case.

\subsubsection{Polygraphs}\label{ssubsec:polyg}
Let $k\in\N$ be a fixed integer. We define, by induction on $n\in\N$,
the notion of {\em $\pair{n}{k}$-polygraph} together with the {\em
  free $\pair{n}{k}$-category} it generates. Note that for all values
$n\leq k$, the invertibility condition is void, and $\pair
nk$-polygraphs are just  {\em $n$-polygraphs}.
\begin{itemize}
\item For $n=0$, an
$\pair{n}{k}$-polygraph $P$ is just a set $P_0$, and the $\pair 0k$-category it
generates, denoted by $\frgp P$, is just the same set $P_0$.
\item Let $n\in\N$ and suppose we have defined the notion of $\pair
  nk$-polygraph $Q$, together with the free $\pair nk$-category $\frgp
  Q$ it generates.

  An $\pair{n{+}1}k$-polygraph is given by an $\pair
  nk$-polygraph $Q$ equipped with a cellular extension $\pair{\frgp
    Q}{P_{n+1}}\in\nCatp n$ of the free $\pair nk$-category $\frgp
  Q$. The free $\pair{n{+}1}k$-category $\frgp P$ generated by $P$ is
  then by definition $\frf{n,k}\pair{\frgp Q}{P_{n+1}}\in \npCat{n+1}k$.
\end{itemize}
The morphisms of $\pair nk$-polygraphs are defined similarly by
induction on $n$. 
\begin{itemize}
\item If $P$, $P'$ are $\pair 0k$-polygraphs, a morphism $p:P\to P$ is
  just a map between the corresponding sets.
\item Let $P$, $P'$ be $\pair{n+1}k$-polygraphs defined by cellular
  extensions $\pair{\frgp Q}{P_{n+1}}$ and $\pair{\frgp{Q'}}{P'_{n+1}}$
  respectively, where $Q$, $Q'$ are $\pair nk$-polygraphs. A morphism
  $p:P\to P'$ is a pair $\pair q\phi$ where $q:Q\to Q'$ is a morphism of
  $\pair nk$-polygraphs and
\[\phi=\pair fg:\pair{\frgp Q}{P_{n+1}}\to\pair{\frgp{Q'}}{P'_{n+1}} \]
 is a morphism of cellular extensions such that $f=\frf{n,k} q$. 
\end{itemize}

\begin{paragr}
  The structure of an $\pair nk$-polygraph $P$ is summarized by the following diagram of sets:
  \[
    \xymatrix@C=1.2cm{P_0 \ar[d]|{\gni{0}}& P_1\doubld{\sce 0}{\tge 0} \ar[d]|{\gni{1}}&\doubld{\sce 1}{\tge 1}& \cdots &   P_{n-1} \doubld{\sce{n-2}}{\tge{n-2}}\ar[d]|{\gni{n-1}}& P_n\doubld{\sce{n-1}}{\tge {n-1}}\\
      \frgp{P}_0 & \dbl \frgp{P}_1 \dbl& \cdots\dbl& \phantom{\frgp{P}} &  \frgp{P}_{n-1}\dbl &.}
  \]
  At each dimension $l$, a new set $P_{l+1}$ of {\em generators} is
  attached by the source and target maps $\sce l$, $\tge l$ to the free
  $\pair lk$-category already built at this level.  The
  maps $\gni l:P_l\to \frgp{P}_l$ represent the insertion of the generators in
  the $l$-cells of the freely generated category.
\end{paragr}

\subsubsection{Formal expressions}\label{ssubsec:formex}
Let $0\leq k\leq n$, $C$ be an $\pair nk$-category, $S$ a set and $X=\pair{x_a}{y_a}_{a\in S}$
a family of pairs of parallel cells in $C_n$, which amounts to a pair
of maps
\[\sce n,\tge n:S\to C_n\]
satisfying the globular relations. The cellular extension
$\pair CX$ generates an $\pair{n{+}1}{k}$-category $\extend{C}=\frf{n,k}\pair
CX$ such that $\trk n \extend{C}=C$. We shall describe the set $\frgp S=\extend{C}_{n+1}$ of
$(n{+}1)$-cells of $\extend{C}$ by means of formal expressions
based on $S$ and $C_n$, quotiented by an equivalence relation. Thus,
given $S$ and $C_n$, we first define the formal language $\expr S$
whose formulas are given by the following grammar
\[
  e ::= \fcst{a} \mid \finv{a} \mid \fid{x} \mid (e\fcomp i e)
\]
where $a\in S$, $x\in C_n$ and $0\leq i\leq n$ . We then define the
subset  $\wtx S\subset\expr S$ of {\em well-typed formulas}.
Precisely, we define the statement
\[\type wxy\]
meaning that {\em $w\in\wtx S$ is of type $\pair xy$} with $x$, $y$ parallel
cells in $C_n$, by the following structural induction:
\begin{itemize}
\item For each $a\in S$ such that $\sce n a=x$ and $\tge n a=y$,
  $\type{\fcst{a}}{x}{y}$
  and $\type{\finv{a}}{y}{x}$.
\item For  each $x\in C_n$, $\type{\fid{x}}{x}{x}$.
 \item If $\type wxy$ and $\type{w'}yz$, then $w''=w\fcomp{n-1}w'$ is
   well-typed and $\type{w''}{x}{z}$.
 \item If $0\leq i<n$, $\type wxy$, $\type{w'}{x'}{y'}$, $\sce
   i{x'}=\tge i{x}$, then $w''=w\fcomp i w'$ is well-typed and
   $\type{w''}{x\comp i x'}{y\comp i y'}$. 
 \end{itemize}
 One readily checks that whenever $\type wxy$ is derivable from the
 preceding rules, then $x$, $y$ are well defined parallel cells in
 $C_n$, so that the maps $\sce n$, $\tge n$ extend to maps
 \[\sce n, \tge n :\wtx S\to C_n\]
 such that, if $\type wxy$,  then $\sce n w=x$ and $\tge n w=y$.

 \subsubsection{Equivalence among formal
   expressions}\label{ssubsec:eqform}
Given $C$ and $S$ as in \ref{ssubsec:formex},  we define a
binary relation $\frel$ on $\wtx{S}$ as follows:
\begin{itemize}
\item For any pair $x$, $x'$ of $i$-composable cells in $C_n$,
  $\fid{x\comp i x'}\frel (\fid{x}\fcomp i\fid{x'})$.
\item For each $a:x\to y$ in $S$, $(\fid{x}\fcomp{n}\fcst{a})\frel
  \fcst{a}$ and $(\fcst a\fcomp{n} \fid{y})\frel \fcst a$.
 \item For each $a:x\to y$ in $S$, $(\fid{y}\fcomp{n}\finv{a})\frel
   \finv{a}$ and $(\finv a\fcomp{n} \fid{x})\frel \finv a$.
\item For each $a:x\to y$ in $S$, $0\leq i< n$, $a_i^{-}=\unit n(\sce i
  x)$ and $a_i^{+}=\unit n(\tge i x)$, $(\fid{a_i^{-}}\fcomp{i}\fcst{a})\frel
  \fcst{a}$ and $(\fcst a\fcomp{i} \fid{a_i^+})\frel \fcst a$.
\item For each $a:x\to y$ in $S$, $0\leq i< n$, $a_i^{-}=\unit n(\sce i
  x)$ and $a_i^{+}=\unit n(\tge i x)$, $(\fid{a_i^{-}}\fcomp{i}\finv{a})\frel
  \finv{a}$ and $(\finv a\fcomp{i} \fid{a_i^+})\frel \finv a$.  
 \item For all expressions $w_1,w_2,w_3$ in $\wtx S$ such that $w_1,w_2$ and
   $w_2,w_3$ are $i$-composable, $((w_1\fcomp i w_2)\fcomp i w_3)\frel
   (w_1\fcomp i(w_2\fcomp i w_3))$.
 \item For all expressions $w_1,w_2,w_3,w_4$ in $\wtx S$ and $i<j$
   such that $w_1,w_2$ and $w_3,w_4$ are
   $j$-composable and $w_1,w_3$ are $i$-composable,
   \[
     ((w_1\fcomp i w_3)\fcomp j (w_2\fcomp i w_4))\frel ((w_1\fcomp j
     w_2)\fcomp i (w_3\fcomp j w_4)).
   \]
  \item For each $a:x\to y$ in $S$, $(\fcst a\fcomp n\finv a)\frel
    \fid{x}$ and $(\finv a\fcomp n\fcst a)\frel \fid y$. 
  \end{itemize}
  Let now $\freq$ denote the congruence generated by
  $\frel$ on $\wtx S$, that is, the smallest equivalence relation
  compatible with compositions containing $\frel$. As for $\frel$, the
  congruence $\freq$ preserves the types. Let us denote by $\wtxeq S$
  the set $\wtx S/\!\!\freq$ of equivalence classes of $\wtx S$ under
  $\freq$ and by
  \[\cans S: \wtx S\to \wtxeq S\]
  the canonical surjection taking an expression $w$ to its
  equivalence class $\cans S(w)=\fcls w$. As the type of an
  expression is invariant under $\frel$, therefore also under $\freq$, 
 the source and target maps
  \[\sce n,\tge n:\wtx S\to C_n\]
  factor through $\cans S$. We keep the same notations for the induced
  source and target maps on $\wtxeq S$:
  \[\sce n,\tge n:\wtxeq S\to C_n.\]
  More generally, for any $i\leq n$, we define the $i$-source and
  $i$-target maps
  \[\sce i,\tge i:\wtxeq S\to C_i\]
  by composing $\sce n,\tge n:\wtxeq S\to C_n$ with the maps $\sce i,\tge
  i:C_n\to C_i$ already given. Now, for any $i$-composable formal expressions
  $w,w'\in \wtx S$ and $w''=(w\fcomp i w')$, the class $\cans S(w'')=\fcls{w''}$ only
  depends on $\fcls w$ and $\fcls{w'}$. Hence we may define 
 $\comp i$-compositions in $\wtxeq S$ by
 \[\fcls{w}\comp i\fcls{w'}=\fcls{(w\fcomp i w')}.\]
 \[\fcls{w}\comp i\fcls{w'}=\fcls{(w\fcomp i w')}.\]
 Also, to any $x\in C_n$ we associate its $n{+}1$-unit in $\wtxeq
  S$ by
  \[\unit{n+1}(x)=\fcls{\fid x}.\]
  Let us define the $n{+}1$-globular set $\extend C$ by
  $\trk n\extend C=C$ and $\sce n,\tge n:\extend C_{n+1}=\wtxeq S\to C_n$.
  The axioms for $\frel$ easily ensure that $\extend C$, endowed with
  the $\comp i$-compositions and units just defined is indeed an
  $\pair{n{+}1}{k}$-category. We claim that $\extend C$ so defined is
  in fact, up to isomorphism, the expected $\pair{n{+}1}{k}$-category
  $\frf n\pair CX$ freely generated by the cellular extension
  $X=\pair{x_a}{y_a}_{a\in S}$ where $x_a=\sce n a$ and $y_a=\tge n
  a$. This amounts to prove that $\extend C$ satisfies the following universal property.
  
\begin{proposition}\label{prop:univprop}
   Let $E$ be an  $\pair{n{+}1}{k}$-category $E$, $h:C\to\trk n E$ a
   morphism of $\pair nk$-categories
   and  $f:S\to E_{n+1}$ a map such that, for any $a\in S$, $\sce n^Ef(a)=\sce n a$
    and $\tge n^E f(a)=\tge n a$.  There is a unique
    morphism $\phi:\extend C\to E$ in $\npCat{n+1}{k}$ such that $\trk
    n\phi=h$ and for each $a\in S$, $\phi(\fcls{\fcst a})=f(a)$.
  \end{proposition}
  \begin{proof}
We first prove uniqueness. As $\phi$ is supposed to coincide with $h$ on
dimensions $\leq n$, we only need to prove uniqueness for its
$(n{+}1)$-component
\[\phi_{n+1}:\wtxeq S\to E_{n+1}.\]
By abuse of
language, we shall simply denote $\phi_{n+1}$ by $\phi$. Thus, suppose
that $\phi$ satisfies the conditions of the proposition and let
\[\psi=\phi \cans{S}:\wtx S\to E_{n+1}.\]
   Let us check,
   by structural induction on formal expressions, that the values of
   $\psi$ are entirely determined:
   \begin{itemize}
   \item If $x\in C_n$ and $w=\fid x$, then $\psi w=\phi\cans{S}
     w=\phi\unit{n+1}(x)=\unit{n+1}(\phi(x))=\unit{n+1}(h(x))$.
   \item If $w=\fcst a$, then $\psi
     w=\phi\cans{S}{\fcst{a}}=\phi\fcls a=f(a)$.
   \item If $w=\finv a$, then $\psi w=\phi\cans{S}{\finv a}=\phi\fcls{\finv
       a}$ but $\fcls{\finv a}$ is the $\comp n$-inverse of
     $\fcls{\fcst a}$, so that $\psi w$ is necessarily the $\comp
     n$-inverse of $f(a)$.
   \item If $w=(w_1\fcomp i w_2)$, where $\psi w_1$ and $\psi w_2$ are
     already determined, then
     \[\psi w=\phi\cans{S}{(w_1\fcomp i w_2)}=\phi(\cans{S}{ w_1}\comp i \cans{S}
      { w_2})=\psi w_1\comp i \psi w_2.\]
  \end{itemize}
  Now, as $\psi$ is uniquely determined and $\cans S$  is surjective,
  $\phi$ is also uniquely determined.

  As for the existence, we first define
  \[\psi:\wtx S\to E_{n+1}\]
  by structural induction on formal expressions, using the unique
  parsing property of
  $\expr S$. Thus we set the
  following values:
  \begin{itemize}
  \item For each $x\in C_n$, $\psi(\fid x)=\unit{n+1}(h(x))$.
  \item For each $a\in S$, $\psi(\fcst a)=f(a)$ and $\psi(\finv a)$ is
    the $\comp n$-inverse of $f(a)$.
  \item Given $w_1,w_2\in \wtx S$ such that $\psi(w_1)$ and
    $\psi(w_2)$ are already defined and $w=(w_1\fcomp i w_2)$ is
    well-typed for some $i\leq n$, then $\psi(w)=\psi(w_1)\comp
    i\psi(w_2)$.
  \end{itemize}
  A straightforward case analysis shows that whenever $w\frel w'$,
  then $\psi(w)=\psi(w')$. Therefore, if $w\freq w'$, then
  $\psi(w)=\psi(w')$, whence $\psi$ factors through $\cans S$, that
  is, there is a map $\phi:\wtxeq S\to E_{n+1}$ such that
  $\psi=\phi\cans S$. By definition, $\phi(\fcls a)=f(a)$, and as $\phi$ so defined preserves source and target
  maps, identities and $\comp i$-compositions, it yields the expected morphism
  $\phi:\extend C\to E$ in $\npCat{n+1}k$.
\end{proof}
  
 

 
 








 
 
 
